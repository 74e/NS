<html>
<head>
    <link rel="stylesheet" type="text/css" href="styles/styles.css">
    <title>Release Berry</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.1/css/all.css" integrity="sha384-O8whS3fhG2OnA5Kas0Y9l3cfpmYjapjI0E4theH4iuMD+pLhbf6JI0jIMfYcK3yZ"
        crossorigin="anonymous">
    <script src="http://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
</head>
<body>
<!-- particles.js container --> 
<div id="particles-js"></div>
  <main class="content">
        <header id="BackToTop">
            <!-- NOT SURE ABOUT IT -->
            <div class="header_text">
                <div class="fancy">
                    RELEASE BERRY
                </div>
            </div>
        </header>
     <!-- <div class="search_area">
            <div class="search_container">
                <div class="icon">
                    <i class="fas fa-search"></i>
                </div>
                <input class="search_box" placeholder="Search for a game">
            </div>
        </div> -->
    </main>
    <div class="body_bg"></div>
    <div class="bg_overlay foreground">
        <div class="triangle_tl foreground"></div>
        <div class="triangle_l foreground"></div>
    </div>

    <footer>
        <p> 
            <a href="#BackToTop">Back to top</a>
        </p>
    </footer>

</body>

<script>
particlesJS("particles-js", {"particles":{"number":{"value":95,"density":{"enable":true,"value_area":800}},"color":{"value":"#8876dc"},"shape":{"type":"circle","stroke":{"width":1,"color":"#8fc8c4"},"polygon":{"nb_sides":4},"image":{"src":"img/github.svg","width":100,"height":100}},"opacity":{"value":0.4917363293133196,"random":false,"anim":{"enable":false,"speed":1,"opacity_min":0.1,"sync":false}},"size":{"value":1,"random":true,"anim":{"enable":false,"speed":40,"size_min":0.1,"sync":false}},"line_linked":{"enable":true,"distance":150,"color":"#4494cd","opacity":0.4,"width":2.0002833734779104},"move":{"enable":true,"speed":6,"direction":"none","random":false,"straight":false,"out_mode":"out","bounce":false,"attract":{"enable":false,"rotateX":600,"rotateY":1200}}},"interactivity":{"detect_on":"canvas","events":{"onhover":{"enable":true,"mode":"bubble"},"onclick":{"enable":true,"mode":"push"},"resize":true},"modes":{"grab":{"distance":557.4324324324319,"line_linked":{"opacity":1}},"bubble":{"distance":367.39864864864836,"size":4,"duration":2,"opacity":0.8311156929027512,"speed":3},"repulse":{"distance":200,"duration":0.4},"push":{"particles_nb":4},"remove":{"particles_nb":2}}},"retina_detect":true});var count_particles, stats, update; stats = new Stats; stats.setMode(0); stats.domElement.style.position = 'absolute'; stats.domElement.style.left = '0px'; stats.domElement.style.top = '0px'; document.body.appendChild(stats.domElement); count_particles = document.querySelector('.js-count-particles'); update = function() { stats.begin(); stats.end(); if (window.pJSDom[0].pJS.particles && window.pJSDom[0].pJS.particles.array) { count_particles.innerText = window.pJSDom[0].pJS.particles.array.length; } requestAnimationFrame(update); }; requestAnimationFrame(update);;
</script>

<script>
       /* ####
        #######
        ####### Minor tweaks for animations
        #######
        ####*/
        $(".search_box").on("focus", function () {
            $("header").css({
                "margin-top": "-50vh"
            });
        }).on("focusout", function () {
            $("header").css({
                "margin-top": "0"
            });
        });
        /* ####
        #######
        ####### Searchbar functionality starts here
        #######
        ####*/
        $(".search_box").val("");
        $(".search_box").on("keyup", function () {
            let s_val = $(this).val().toLowerCase();
            console.log(s_val);
            $(".box").each(function (i) {
                let g_current = $(this);
                let g_title = g_current.find(".game_title").text().toLowerCase();
                if (!g_title.includes(s_val)) {
                    g_current.css({
                        "display": "none"
                    });
                } else {
                    g_current.css({
                        "display": "flex"
                    });
                }
            });
        });
        /* ####
        #######
        #######  Game-Element generation/assembly starts here
        #######
        ####*/
        function pad(num, padlen, padchar) {
            var pad_char = typeof padchar !== 'undefined' ? padchar : '0';
            var pad = new Array(1 + padlen).join(pad_char);
            return (pad + num).slice(-pad.length);
        }
        // Set the date we're counting down to
        var countDownDate = new Date().getTime();
        var timer_i = 0;
        var intervals = {};
        $.getJSON("data/games.json", {}, function (data) {
            for (const [key, value] of Object.entries(data)) {
                console.log(key, value);
                var timer = "timer" + timer_i;
                $("body .content").append(
                    `<div class="box">
                       <div class="overlay"></div>
                       <div class="cover"></div>
                       <p class="game_title">${key}</p>
                       <div class="timerbox">
                           <p id="${timer}"></p>
                       </div>
                     </div>`
                );
                (function (timer) {
                    // Add it to an array so it can be killed if needed
                    intervals[timer] = setInterval(function () {
                        var element = $(`#${timer}`);
                        // If there's no date yet
                        if (value[0].startsWith("TBC")) {
                            element.html(`<span class="to_be_confirmed">${value[0]}</span>`);
                            element.parent().parent().find(".overlay").css({
                                "opacity": 0.9
                            });
                            clearInterval(intervals[timer]);
                            return;
                        } else {
                            var countDownDate = new Date(value[0]).getTime();
                            var now = new Date().getTime();
                            var released = false;
                        }
                        if (now > countDownDate) {
                            // This means we're past the date so it released
                            released = true;
                            element.html(`<span class="released">RELEASED</span>`);
                            element.parent().parent().find(".overlay").css({
                                "opacity": 0.9
                            });
                            clearInterval(intervals[timer]);
                            return;
                        }
                        // Find the distance between now an the count down date
                        var distance = countDownDate - now;
                        // Time calculations for days, hours, minutes and seconds
                        var days = Math.floor(distance / (1000 * 60 * 60 * 24));
                        var hours = pad(Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 *
                            60)), 2);
                        var minutes = pad(Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60)),
                            2);
                        var seconds = pad(Math.floor((distance % (1000 * 60)) / 1000), 2);
                        if (!released) {
                            if (days > 0) {
                                element.html(days + ":" + hours + ":" + seconds);
                            } else {
                                element.html(hours + ":" +
                                    minutes + ":" + seconds);
                            }
                        }
                    }, 1000);
                })(timer);
                timer_i++;
            }
        });
</script>    
    
</html>
